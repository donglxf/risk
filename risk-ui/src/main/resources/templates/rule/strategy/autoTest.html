<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>table模块快速使用</title>
<link rel="stylesheet" href="/rule/ui/plugins/layui/css/layui.css"
	media="all">
<link rel="stylesheet"
	href="/rule/ui/plugins/font-awesome/css/font-awesome.min.css"
	media="all" />
</head>
<body>


	<div class="admin-main">
		<div class="layui-row" style="margin-top: 10px;">
			<div class="layui-col-xs4" id="bind">
				<form class="layui-form" action="" lay-filter="test1">
					<input type="hidden" name="senceVersionId" id="senceVersionId">
					<input type="hidden" name="senceId" id="senceId">
					<input type="hidden" name="sceneIdentify" id="sceneIdentify">
					<div class="layui-form-item">
						<label class="layui-form-label">验证次数:</label>
						<div class="layui-col-md2">
							<select id="excuteTotal" class="layui-select" name="excuteTotal" lay-verify="">
								<option value="5">5</option>
								<option value="10">10</option>
								<option value="15">15</option>
							</select>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-input-block">
							<button class="layui-btn" lay-submit lay-filter="formDemo">立即验证</button>
							<button class="layui-btn" lay-submit lay-filter="validationPass">验证通过</button>
							<!--<button class="layui-btn" lay-submit lay-filter="development" id="development" style="display:none;">发布</button>-->
						</div>
					</div>
				</form>
			</div>
		</div>
		<div id="layui-row">
			<div class="layui-col-md3">
				<div class="layui-form-item">
					<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
						<legend>验证结果</legend>
					</fieldset>
					<div class="layui-input-block" id="autoValidateResults">
						<label id="resultShow"></label>
					</div>
				</div>
			</div>
			<div class="layui-col-md9">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
					<legend>当前显示</legend>
				</fieldset>
				<div class="layui-input-block">
					<table class="layui-table" id="ruleTab">

					</table>
				</div>
			</div>
		</div>
	</div>

	<script src="/rule/ui/plugins/layui/layui.js"></script>
	<script src="/rule/ui/src/js/model/model_util.js"></script>

	<script>
    //Demo
    layui.use('form', function(){
        var form = layui.form;
        var app = layui.app,
            layerTips = layui.layer,
            $ = layui.jquery;

        // 验证通过
        form.on('submit(validationPass)', function (data) {
            $.ajax({
                cache: true,
                type: "POST",
                url: '/rule/service/strategy/variablePass',
                data: data.field,// 你的formid
                async: false,
                error: function (request) {
                    alert("Connection error");
                },
                success: function (da) {
                    if (da.code == 0) {
                        layer.msg("操作成功");
                    } else {
                        layer.msg(data.msg);
                    }
                }
            });
            return false;
        });


        //监听表单提交
        form.on('submit(formDemo)', function(data){
           $.ajax({
                cache : true,
                type : "POST",
                url : '/rule/service/variableBind/autoVariable',
                data : data.field,// 你的formid
                async : false,
                error : function(request) {
                    alert("Connection error");
                },
                success : function(da) {
                    if (da.code == 0) {
                        var modelVerification = new ModelVerification();
                        var result = modelVerification.initRuleBatchResult(da.data);
                        $("#resultShow").html(result);
//                        layer.msg('操作成功');
//                        var resultMsg="成功数："+da.data.success+",失败数："+da.data.fail;
//						$("#validateResult").val(resultMsg);
//                        showRuleTestResult(da.data.logId, da.data.versionId);
//                       active.reload();
                    } else {
                        $("#validateResult").val(da.msg);
//                       layer.msg(da.msg);
                    }
                }
            });
            return false;
        });
    });

    function showRuleTestResult(logId, versionId) {
        $
            .ajax({
                cache: true,
                type: "GET",
                url: '/rule/service/strategy/ruleMatchResult/' + logId + '/' + versionId, // 数据接口
                async: false,
                error: function (request) {
                    alert("Connection error");
                },
                success: function (da) {
                    console.log(da);
                    var size = da.data.length;
                    var modelVerification = new ModelVerification();
                    var result = modelVerification.initResult(da.data);
                    $("#ruleTab").html(result);
                }
            });
    }
</script>
</body>
</html>